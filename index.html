<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> Near-Earth Asteroid Tracker (7-Day)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #0b1120;
      color: #e5e7eb;
      min-height: 100vh;
    }
    .neo-card {
      background-color: #1f2937;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    .data-list::-webkit-scrollbar {
      width: 8px;
    }
    .data-list::-webkit-scrollbar-thumb {
      background-color: #4b5563;
      border-radius: 4px;
    }
    .data-list::-webkit-scrollbar-track {
      background: #1f2937;
    }
    .date-section {
      background-color: #374151;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    date-section:hover {
      background-color: #4b5563;
    }
    .table-row-content {
      max-height: 1000px;
      overflow: hidden;
      transition: max-height 0.4s ease-out;
    }
    .collapsed {
      max-height: 0;
    }
  </style>
</head>
<body class="p-4 flex flex-col items-center justify-center">

  <div id="app" class="max-w-5xl w-full mx-auto my-8">
    <header class="text-center mb-10">
      <h1 class="text-4xl sm:text-5xl font-extrabold text-red-400 tracking-tight mb-2">
        ü™ê Celestial Watch: Tracking Close Cosmic Encounters
      </h1>
      <p class="text-xl text-gray-400">More cosmic intelligence and tracking upgrades are coming soon. Stay connected!</p>
    </header>
    <div class="neo-card p-4 rounded-xl mb-6 flex flex-col sm:flex-row gap-4 items-center justify-between">
      <div class="flex flex-col sm:flex-row items-center gap-4 w-full sm:w-auto">
        <label for="start-date-input" class="text-gray-300 whitespace-nowrap">Start Date (7-day range):</label>
        <input type="date" id="start-date-input" class="p-2 rounded bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-400 transition" />
      </div>
      <button id="fetch-data-btn" class="w-full sm:w-auto px-6 py-2 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg shadow-md transition duration-200">
        Fetch Data
      </button>
    </div>
    <div id="loading" class="text-center text-xl text-blue-300 p-10 hidden">
      <svg class="animate-spin h-8 w-8 text-blue-400 mx-auto mb-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      Scanning a 7-day orbit...
    </div>

    <div id="neo-content" class="neo-card rounded-xl p-0 hidden overflow-hidden">
      <div class="data-list overflow-x-auto max-h-[80vh] overflow-y-auto">
        <div id="neo-data-container"></div>
      </div>
      <div id="no-neo-message" class="text-center text-lg text-green-400 p-8 hidden">
        Hooray! No known Near-Earth Objects are approaching in the selected 7-day range. The skies are clear!
      </div>
    </div>
    <div id="error-message" class="text-center text-red-400 hidden p-8 bg-red-900/30 rounded-xl">
      <p class="font-bold text-lg">Failed to retrieve Asteroid data.</p>
      <p id="error-details" class="text-sm mt-2"></p>
    </div>
    <footer class="mt-10 text-center text-gray-400 text-sm">
      <p>Developed by 
        <a href="https://github.com/FairozAhmadSheikh" target="_blank" class="text-blue-400 hover:text-blue-300 underline ml-1">Fairoz Ahmad Sheikh</a>
        |
        <a href="https://portfolio-three-gray-24.vercel.app/" target="_blank" class="text-pink-400 hover:text-pink-300 underline ml-1">Portfolio</a>
      </p>
    </footer>
  </div>

 <script>
    const API_KEY = "DEMO_KEY";
    const BASE_URL = "https://api.nasa.gov/neo/rest/v1/feed"; // ‚úÖ Corrected endpoint
    const loadingDiv = document.getElementById('loading');
    const contentDiv = document.getElementById('neo-content');
    const errorDiv = document.getElementById('error-message');
    const errorDetails = document.getElementById('error-details');
    const dataContainerEl = document.getElementById('neo-data-container');
    const noNeoMessageEl = document.getElementById('no-neo-message');
    const startDateInput = document.getElementById('start-date-input');
    const fetchDataBtn = document.getElementById('fetch-data-btn');
    const MAX_RETRIES = 3;
    const INITIAL_DELAY_MS = 1000;

    const getFormattedDate = (date) => date.toISOString().split('T')[0];
    const createLocalAnchorDate = (dateString) => {
      const parts = dateString.split('-');
      return new Date(parts[0], parts[1] - 1, parts[2]);
    };
    const calculateEndDate = (startDateString) => {
      const date = createLocalAnchorDate(startDateString);
      date.setDate(date.getDate() + 6);
      return getFormattedDate(date);
    };
    const formatNumber = (num, decimals = 0) =>
      new Intl.NumberFormat('en-US', { maximumFractionDigits: decimals }).format(num);
    const today = new Date();
    const maxDate = new Date();
    maxDate.setDate(maxDate.getDate() + 60);
    startDateInput.value = getFormattedDate(today);
    startDateInput.max = getFormattedDate(maxDate);

    async function fetchNeoFeed(startDate, retries = 0) {
      loadingDiv.classList.remove('hidden');
      contentDiv.classList.add('hidden');
      errorDiv.classList.add('hidden');
      noNeoMessageEl.classList.add('hidden');
      dataContainerEl.innerHTML = '';
      const endDate = calculateEndDate(startDate);
      const apiUrl = `${BASE_URL}?start_date=${startDate}&end_date=${endDate}&api_key=${API_KEY}`;

      try {
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        displayNeoFeed(data, startDate, endDate);
        } catch (error) {
        console.error("Fetch NeoWs error:", error);
        if (retries < MAX_RETRIES) {
          const delay = INITIAL_DELAY_MS * Math.pow(2, retries);
          await new Promise(resolve => setTimeout(resolve, delay));
          await fetchNeoFeed(startDate, retries + 1);
        } else {
          errorDetails.textContent = `Error: ${error.message}. This might be a temporary API or network issue.`;
          errorDiv.classList.remove('hidden');
          loadingDiv.classList.add('hidden');
        }
      }
    }
    function displayNeoFeed(data, startDate, endDate) {
      const neoObjects = data.near_earth_objects;
      const dates = Object.keys(neoObjects).sort();
      let totalAsteroids = 0;

      if (dates.length === 0 || dates.every(date => neoObjects[date].length === 0)) {
        noNeoMessageEl.classList.remove('hidden');
      } else {
        dates.forEach((dateKey, index) => {
          const asteroids = neoObjects[dateKey];
          if (asteroids.length === 0) return;
          totalAsteroids += asteroids.length;

          const dateHeader = document.createElement('div');
          dateHeader.className = 'date-section p-4 text-xl font-semibold flex justify-between items-center border-t border-gray-700';
          dateHeader.innerHTML = `
            <span>${new Date(dateKey).toDateString()} (${asteroids.length} approaches)</span>
            <span id="arrow-${dateKey}" class="transform transition-transform duration-200">‚ñº</span>
          `;
          dateHeader.setAttribute('data-target', `table-content-${dateKey}`);
          const tableContainer = document.createElement('div');
          tableContainer.id = `table-content-${dateKey}`;
          tableContainer.className = `table-row-content ${index > 0 ? 'collapsed' : ''}`;
          dateHeader.onclick = () => {
            tableContainer.classList.toggle('collapsed');
            const arrowEl = document.getElementById(`arrow-${dateKey}`);
            if (arrowEl) arrowEl.classList.toggle('rotate-180');
          };
          const tableHTML = `
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-700">
                <thead class="bg-gray-800">
                  <tr>
                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Name</th>
                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider hidden sm:table-cell">Approach Time (UTC)</th>
                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Miss Distance (km)</th>
                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Size (m)</th>
                    <th class="px-3 py-3 text-center text-xs font-medium text-gray-400 uppercase tracking-wider">Hazard</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-gray-800">
                  ${asteroids.map(neo => {
                    const approach = neo.close_approach_data[0];
                    const minKm = neo.estimated_diameter.kilometers.estimated_diameter_min;
                    const maxKm = neo.estimated_diameter.kilometers.estimated_diameter_max;
                    const avgMeters = ((minKm + maxKm) / 2) * 1000;
                    const missDistance = formatNumber(parseFloat(approach.miss_distance.kilometers), 0);
                    const closeApproachTime = new Date(approach.close_approach_date_full).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false, timeZone: 'UTC' });
                    const hazardText = neo.is_potentially_hazardous_asteroid
                      ? `<span class="inline-block px-2 py-0.5 text-xs font-semibold rounded-full bg-red-600 text-white">YES</span>`
                      : `<span class="inline-block px-2 py-0.5 text-xs font-semibold rounded-full bg-green-600 text-white">No</span>`;
                    return `
                    <tr class="hover:bg-gray-700 transition duration-150 ease-in-out">
                        <td class="px-3 py-4 text-sm font-medium text-blue-300"><a href="${neo.nasa_jpl_url}" target="_blank" class="hover:text-blue-400 transition">${neo.name}</a></td>
                        <td class="px-3 py-4 text-sm text-gray-400 hidden sm:table-cell">${closeApproachTime}</td>
                        <td class="px-3 py-4 text-sm text-gray-400">${missDistance} km</td>
                        <td class="px-3 py-4 text-sm text-gray-300">~${formatNumber(avgMeters, 0)} m</td>
                        <td class="px-3 py-4 text-center text-sm">${hazardText}</td>
                      </tr>`;
                  }).join('')}
                </tbody>
              </table>
            </div>`;
          tableContainer.innerHTML = tableHTML;
          dataContainerEl.appendChild(dateHeader);
          dataContainerEl.appendChild(tableContainer);
        });
        const firstArrow = document.getElementById(`arrow-${dates[0]}`);
        if (firstArrow) firstArrow.classList.add('rotate-180');
      }

      loadingDiv.classList.add('hidden');
      contentDiv.classList.remove('hidden');
    }
    fetchDataBtn.addEventListener('click', () => {
      const selectedDate = startDateInput.value;
      if (selectedDate) fetchNeoFeed(selectedDate);
      else {
        errorDetails.textContent = "Please select a valid start date.";
        errorDiv.classList.remove('hidden');
      }
    });
     window.onload = () => fetchNeoFeed(startDateInput.value);
  </script>
</body>
</html>
